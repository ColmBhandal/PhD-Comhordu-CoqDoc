<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>LanguageFoundations</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library LanguageFoundations</h1>

<div class="code">
</div>

<div class="doc">
This file was written by Colm Bhandal, PhD student, Foundations and Methods group,
School of Computer Science and Statistics, Trinity College, Dublin, Ireland.
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ComhCoq.Extras.LibTactics</span>.<br/>

<br/>
</div>

<div class="doc">
This file lays down the foundation for the software language file by defining things like expressions and evaluation of expressions.
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ComhCoq.GenTacs</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ComhCoq.StandardResults</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">Relations</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">Lists.ListSet</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">Reals</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">Logic.FunctionalExtensionality</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ComhCoq.ComhBasics</span>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">nat_scope</span>.<br/>

<br/>
</div>

<div class="doc">
A countably infinite set of variables indexed by natural numbers.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Var</span> : <span class="id" title="keyword">Type</span>:=<br/>
&nbsp;&nbsp;| <span class="id" title="var">var</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Var</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqDecVar</span> : <span class="id" title="var">eqDec</span> <span class="id" title="var">Var</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">eqDec</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x1</span>, <span class="id" title="var">x2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eq_nat_dec</span> <span class="id" title="var">n</span> <span class="id" title="var">n0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
BaseType type elements are either a mode, a time, a position, a distance or a delay.
We use coercions to reduce constructor verbosity.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">BaseType</span> : <span class="id" title="keyword">Type</span>:=<br/>
&nbsp;&nbsp;| <span class="id" title="var">baseMode</span> :&gt; <span class="id" title="var">Mode</span> -&gt; <span class="id" title="var">BaseType</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseTime</span> :&gt; <span class="id" title="keyword">Time</span> -&gt; <span class="id" title="var">BaseType</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">basePosition</span> :&gt; <span class="id" title="var">Position</span> -&gt; <span class="id" title="var">BaseType</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseDistance</span> :&gt; <span class="id" title="var">Distance</span> -&gt; <span class="id" title="var">BaseType</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseDelay</span> :&gt; <span class="id" title="var">Delay</span> -&gt; <span class="id" title="var">BaseType</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseNonneg</span> :&gt; <span class="id" title="var">nonnegreal</span> -&gt; <span class="id" title="var">BaseType</span>.<br/>

<br/>
</div>

<div class="doc">
Equality on the base type is decidable.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqDecBase</span> : <span class="id" title="var">eqDec</span> <span class="id" title="var">BaseType</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">eqDec</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">decidable</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x1</span>, <span class="id" title="var">x2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecMode</span> <span class="id" title="var">m</span> <span class="id" title="var">m0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecTime</span> <span class="id" title="var">t</span> <span class="id" title="var">t0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecPosition</span> <span class="id" title="var">p</span> <span class="id" title="var">p0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecDistance</span> <span class="id" title="var">d</span> <span class="id" title="var">d0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecDelay</span> <span class="id" title="var">d</span> <span class="id" title="var">d0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecNonnegReal</span> <span class="id" title="var">n</span> <span class="id" title="var">n0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A simple expression language over the base types.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Exp</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">eVar</span> :&gt; <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eBase</span> :&gt; <span class="id" title="var">BaseType</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eSubtract</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eAdd</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eMult</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eWaitTime</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ePeriod</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eDist</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eFailSafeSucc</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span>.<br/>

<br/>
</div>

<div class="doc">
Equality is decidable on expressions.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqDecExp</span> : <span class="id" title="var">eqDec</span> <span class="id" title="var">Exp</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">eqDec</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHx1_1</span> <span class="id" title="var">x2_1</span>); <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; [<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHx1_2</span> <span class="id" title="var">x2_2</span>); <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; [<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">f_equal</span> | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>] | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>]]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHx1</span> <span class="id" title="var">x2</span>); <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;[<span class="id" title="tactic">left</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">reflexivity</span> | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">v0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b</span> <span class="id" title="var">b0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A set of channels.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Channel</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">chanAN</span> | <span class="id" title="var">chanMStable</span> | <span class="id" title="var">chanMCurr</span> | <span class="id" title="var">chanMNext</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">chanPos</span> | <span class="id" title="var">chanOutProc</span> | <span class="id" title="var">chanInProc</span> | <span class="id" title="var">chanIOEnv</span> | <span class="id" title="var">chanTrans</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">chanWake</span> | <span class="id" title="var">chanPause</span> | <span class="id" title="var">chanUnpause</span> | <span class="id" title="var">chanBad</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">chanAbort</span>.<br/>

<br/>
</div>

<div class="doc">
Equality on channels is decidable.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqDecChannel</span> : <span class="id" title="var">eqDec</span> <span class="id" title="var">Channel</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">eqDec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x1</span>, <span class="id" title="var">x2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A substitution is a mapping from variables to expressions.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Subst</span> := <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">Exp</span>.<br/>

<br/>
</div>

<div class="doc">
The id substitution simply lifts every variable to an expression i.e. it
maps every variable to itself, with the eVar constructor as a wrapper.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">idSubst</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) : <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">eVar</span> <span class="id" title="var">v</span>).<br/>

<br/>
</div>

<div class="doc">
Maps the function s over e, replacing all variables with their
corresponding expression..
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">subExp</span> (<span class="id" title="var">s</span> : <span class="id" title="var">Subst</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eVar</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">s</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eBase</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">eBase</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eSubtract</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">eSubtract</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eAdd</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">eAdd</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eMult</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">eMult</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eWaitTime</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">eWaitTime</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ePeriod</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">ePeriod</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eDist</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">eDist</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eFailSafeSucc</span> <span class="id" title="var">e1</span> =&gt; <span class="id" title="var">eFailSafeSucc</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
If one number is less than another, then they are not equal.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_neq_nat</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> &lt; <span class="id" title="var">m</span> -&gt; <span class="id" title="var">n</span> &lt;&gt; <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">lt_pred</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Given any two numbers, they are either equal or not.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">natDec</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;{<span class="id" title="var">n</span> = <span class="id" title="var">m</span>} + {<span class="id" title="var">n</span> &lt;&gt; <span class="id" title="var">m</span>}. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> ({<span class="id" title="var">n</span> &lt; <span class="id" title="var">m</span>} + {<span class="id" title="var">n</span> = <span class="id" title="var">m</span>} + {<span class="id" title="var">m</span> &lt; <span class="id" title="var">n</span>}).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">lt_eq_lt_dec</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">lt_neq_nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">lt_neq_nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Given any two variables, they are either equal or not.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">varEqDec</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Var</span>,<br/>
&nbsp;&nbsp;{<span class="id" title="var">x</span> = <span class="id" title="var">y</span>} + {<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> ({<span class="id" title="var">n</span> = <span class="id" title="var">n0</span>} + {<span class="id" title="var">n</span> &lt;&gt; <span class="id" title="var">n0</span>}). <span class="id" title="tactic">apply</span> <span class="id" title="var">natDec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
True if the arguments are equal, false otherwise.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">varEq</span> (<span class="id" title="var">v1</span> <span class="id" title="var">v2</span> : <span class="id" title="var">Var</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">left</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">right</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Stolen from tutorial. Takes any function with domain Var and overrides
it with a new v -&gt; x pair.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">update</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">X</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">X</span>) : (<span class="id" title="var">Var</span> -&gt; <span class="id" title="var">X</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">v'</span> =&gt; <span class="id" title="keyword">if</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">x</span> <span class="id" title="keyword">else</span> (<span class="id" title="var">f</span> <span class="id" title="var">v'</span>).<br/>

<br/>
</div>

<div class="doc">
Turns a pair of lists lv : <span class="inlinecode"><span class="id" title="var">variables</span></span> le : <span class="inlinecode"><span class="id" title="var">expressions</span></span> into a substitution function
from variables to expressions which is the identity at all points except those in lv,
which are mapped to their corresponding element of le. Note: If values are repeated in lv,
then earlier values override later ones.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">listsToSub</span> (<span class="id" title="var">lv</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">lex</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="var">Subst</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">lv</span> , <span class="id" title="var">lex</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">v</span> :: <span class="id" title="var">lv'</span> , <span class="id" title="var">e</span> :: <span class="id" title="var">lex'</span> =&gt; (<span class="id" title="var">update</span> (<span class="id" title="var">listsToSub</span> <span class="id" title="var">lv'</span> <span class="id" title="var">lex'</span>) <span class="id" title="var">v</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;| [] , <span class="id" title="var">_</span> :: <span class="id" title="var">_</span> =&gt; <span class="id" title="var">idSubst</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> , [] =&gt; <span class="id" title="var">idSubst</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Applies the substitution to each element of the list.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">listSub</span> (<span class="id" title="var">s</span> : <span class="id" title="var">Subst</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">map</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span>) <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
Is the variable v in the list lv.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">inVarList</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">lv</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">lv</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">v'</span> :: <span class="id" title="var">lv'</span> =&gt; <span class="id" title="keyword">if</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">v</span> <span class="id" title="var">lv'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Resets all the variables in lv to map to themselves.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">resetSub</span> (<span class="id" title="var">s</span> : <span class="id" title="var">Subst</span>) (<span class="id" title="var">lv</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) : <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">v</span> <span class="id" title="var">lv</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">true</span> =&gt; <span class="id" title="var">eVar</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">false</span> =&gt; <span class="id" title="var">s</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">R_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Evaluates certain base values (Delay, Time, Distance, Nonneg) to nonnegative reals.
Used to "normalise" the types of things so that +, - and * can be computed over
expressions.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">evalBaseNonneg</span> : <span class="id" title="var">BaseType</span> -&gt; <span class="id" title="var">nonnegreal</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ebnDel</span> <span class="id" title="var">r</span> : <span class="id" title="var">evalBaseNonneg</span> (<span class="id" title="var">baseDelay</span> (<span class="id" title="var">mkDelay</span> <span class="id" title="var">r</span>)) (<span class="id" title="var">posToNonneg</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ebnTime</span> <span class="id" title="var">r</span> : <span class="id" title="var">evalBaseNonneg</span> (<span class="id" title="var">baseTime</span> (<span class="id" title="var">mkTime</span> <span class="id" title="var">r</span>)) <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ebnDistance</span> <span class="id" title="var">r</span> : <span class="id" title="var">evalBaseNonneg</span> (<span class="id" title="var">baseDistance</span> (<span class="id" title="var">mkDistance</span> <span class="id" title="var">r</span>)) <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ebnNonneg</span> <span class="id" title="var">r</span> : <span class="id" title="var">evalBaseNonneg</span> (<span class="id" title="var">baseNonneg</span> <span class="id" title="var">r</span>) <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;b \_/ r" := (<span class="id" title="var">evalBaseNonneg</span> <span class="id" title="var">b</span> <span class="id" title="var">r</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 45).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalBaseNonneg_unique</span> <span class="id" title="var">b</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r1</span> -&gt; <span class="id" title="var">b</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r2</span> -&gt; <span class="id" title="var">r1</span> = <span class="id" title="var">r2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">evalBaseNonnegFun</span> (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>) : <span class="id" title="var">option</span> <span class="id" title="var">nonnegreal</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseDelay</span> (<span class="id" title="var">mkDelay</span> <span class="id" title="var">r</span>) =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">posToNonneg</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">baseTime</span> (<span class="id" title="var">mkTime</span> <span class="id" title="var">r</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseDistance</span> (<span class="id" title="var">mkDistance</span> <span class="id" title="var">r</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">baseNonneg</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalBaseNonneg_rel_fun</span> <span class="id" title="var">b</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r</span> -&gt; <span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalBaseNonneg_fun_rel</span> <span class="id" title="var">b</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">b</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- ?<span class="id" title="var">f</span> ?<span class="id" title="var">x</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span> <span class="id" title="keyword">end</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Evaluation on terms of Exp. Note that only closed terms will actually evaluate to
something. If we can prove evalExp e b then e evaluates to b.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">evalExp</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">BaseType</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalBase</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>, <span class="id" title="var">evalExp</span> (<span class="id" title="var">eBase</span> <span class="id" title="var">b</span>) <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">evalSub</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b1</span> <span class="id" title="var">b2</span> : <span class="id" title="var">BaseType</span>) (<span class="id" title="var">r1</span> <span class="id" title="var">r2</span> : <span class="id" title="var">nonnegreal</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">b1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">b2</span> -&gt; <span class="id" title="var">b1</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r1</span> -&gt; <span class="id" title="var">b2</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> (<span class="id" title="var">eSubtract</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">r1</span> -<span class="id" title="var">nn</span>- <span class="id" title="var">r2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalAdd</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b1</span> <span class="id" title="var">b2</span> : <span class="id" title="var">BaseType</span>) (<span class="id" title="var">r1</span> <span class="id" title="var">r2</span> : <span class="id" title="var">nonnegreal</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">b1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">b2</span> -&gt; <span class="id" title="var">b1</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r1</span> -&gt; <span class="id" title="var">b2</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> (<span class="id" title="var">eAdd</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">r1</span> +<span class="id" title="var">nn</span>+ <span class="id" title="var">r2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalMult</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b1</span> <span class="id" title="var">b2</span> : <span class="id" title="var">BaseType</span>) (<span class="id" title="var">r1</span> <span class="id" title="var">r2</span> : <span class="id" title="var">nonnegreal</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">b1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">b2</span> -&gt; <span class="id" title="var">b1</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r1</span> -&gt; <span class="id" title="var">b2</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">r2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> (<span class="id" title="var">eMult</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">r1</span> *<span class="id" title="var">nn</span>* <span class="id" title="var">r2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalWait</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">m1</span> : <span class="id" title="var">Mode</span>) (<span class="id" title="var">m2</span> : <span class="id" title="var">Mode</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">m1</span> -<span class="id" title="var">mtr</span>-&gt; <span class="id" title="var">m2</span>), <span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">m2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> (<span class="id" title="var">eWaitTime</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">waitTime</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">p</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalPeriod</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">Mode</span>), <span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> (<span class="id" title="var">ePeriod</span> <span class="id" title="var">e</span>) (<span class="id" title="var">period</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalDist</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">p1</span> <span class="id" title="var">p2</span> : <span class="id" title="var">Position</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">p1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">p2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> (<span class="id" title="var">eDist</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">mkDistance</span> (<span class="id" title="var">dist2d</span> <span class="id" title="var">p1</span> <span class="id" title="var">p2</span>))<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalFailSafeSucc</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">Mode</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">evalExp</span> (<span class="id" title="var">eFailSafeSucc</span> <span class="id" title="var">e</span>) (<span class="id" title="var">failSafeSucc</span> <span class="id" title="var">m</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;e |_| b" := (<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50).<br/>

<br/>
</div>

<div class="doc">
Option map function for two arguments.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">optionMap2</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">a</span> : <span class="id" title="var">option</span> <span class="id" title="var">A</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">option</span> <span class="id" title="var">B</span>) : <span class="id" title="var">option</span> <span class="id" title="var">C</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">option_map</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">g</span> =&gt; <span class="id" title="var">option_map</span> <span class="id" title="var">g</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
A functional encoding of the evaluation relation as a partial function. The
proof that the two coincide is a separate issue! This function, due to its dealings
with the horrid option type, is quite ugly and hard to understand, but its advantage
is its computability. Once it is linked to the relation via proofs, it can be left as
an under the hood engine that "computes" the relation.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evalExpFun</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="var">option</span> <span class="id" title="var">BaseType</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eVar</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eBase</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eSubtract</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b1</span>), (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">r1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">r2</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">baseNonneg</span> (<span class="id" title="var">r1</span> -<span class="id" title="var">nn</span>- <span class="id" title="var">r2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eAdd</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b1</span>), (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">r1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">r2</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">baseNonneg</span> (<span class="id" title="var">r1</span> +<span class="id" title="var">nn</span>+ <span class="id" title="var">r2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eMult</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b1</span>), (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">r1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">r2</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">baseNonneg</span> (<span class="id" title="var">r1</span> *<span class="id" title="var">nn</span>* <span class="id" title="var">r2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">eWaitTime</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b1</span>, <span class="id" title="var">b2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">baseMode</span> <span class="id" title="var">m1</span>, <span class="id" title="var">baseMode</span> <span class="id" title="var">m2</span> =&gt; <span class="id" title="var">option_map</span> <span class="id" title="var">baseTime</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">option_map</span> (<span class="id" title="var">waitTime</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>) (<span class="id" title="var">modeTransRelOpt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <br/>
&nbsp;&nbsp;| <span class="id" title="var">ePeriod</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e'</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">baseMode</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">baseTime</span> (<span class="id" title="var">period</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eDist</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b1</span>, <span class="id" title="var">b2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">basePosition</span> <span class="id" title="var">p1</span>, <span class="id" title="var">basePosition</span> <span class="id" title="var">p2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">baseDistance</span> ((<span class="id" title="var">mkDistance</span> (<span class="id" title="var">dist2d</span> <span class="id" title="var">p1</span> <span class="id" title="var">p2</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eFailSafeSucc</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e'</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">baseMode</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">baseMode</span> (<span class="id" title="var">failSafeSucc</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalBaseNonneg_rel_fun_step</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">V</span> : <span class="id" title="var">_</span> \<span class="id" title="var">_</span>/ <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">evalBaseNonneg_rel_fun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">V</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalBaseNonneg_rel_fun_tac</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="var">evalBaseNonneg_rel_fun_step</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalBaseNonneg_fun_rel_step</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">V</span> : <span class="id" title="var">Some</span> <span class="id" title="var">_</span> = <span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">V</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalBaseNonneg_fun_rel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">V</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalBaseNonneg_fun_rel_tac</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="var">evalBaseNonneg_fun_rel_step</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
If e evaluates to b via the evaluation relation then it does so also by the evalution
function.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalExpRelFun</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span> = <span class="id" title="var">Some</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalExp</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalExp1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalExp2</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">option_map</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">evalBaseNonneg_rel_fun_tac</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">modeTransRelOpt</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">modeTransRelDec</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">proof_irrelevance</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">false</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If e evaluates to b via the evaluation function then it does so
also by the evalution relation.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalExpFunRel</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span> = <span class="id" title="var">Some</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>.<br/>
</div>

<div class="doc">
Subtract case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ev1</span>, <span class="id" title="var">ev2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">bv0</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">bv1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">bv0</span>, <span class="id" title="var">bv1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>]. <span class="id" title="var">evalBaseNonneg_fun_rel_tac</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">econstructor</span>; [<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe1</span>; <span class="id" title="tactic">reflexivity</span> |<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe2</span>; <span class="id" title="tactic">reflexivity</span> | | ]; <span class="id" title="tactic">assumption</span>.<br/>
</div>

<div class="doc">
Add case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ev1</span>, <span class="id" title="var">ev2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">bv0</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">bv1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">bv0</span>, <span class="id" title="var">bv1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>]. <span class="id" title="var">evalBaseNonneg_fun_rel_tac</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">econstructor</span>; [<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe1</span>; <span class="id" title="tactic">reflexivity</span> |<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe2</span>; <span class="id" title="tactic">reflexivity</span> | | ]; <span class="id" title="tactic">assumption</span>.<br/>
</div>

<div class="doc">
Multiply case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ev1</span>, <span class="id" title="var">ev2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">bv0</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">bv1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">bv0</span>, <span class="id" title="var">bv1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>]. <span class="id" title="var">evalBaseNonneg_fun_rel_tac</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">econstructor</span>; [<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe1</span>; <span class="id" title="tactic">reflexivity</span> |<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe2</span>; <span class="id" title="tactic">reflexivity</span> | | ]; <span class="id" title="tactic">assumption</span>.<br/>
</div>

<div class="doc">
waitTime case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ev1</span>, <span class="id" title="var">ev2</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe1</span> <span class="id" title="var">b0</span> (<span class="id" title="var">eq_refl</span> (<span class="id" title="var">Some</span> <span class="id" title="var">b0</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe2</span> <span class="id" title="var">b1</span> (<span class="id" title="var">eq_refl</span> (<span class="id" title="var">Some</span> <span class="id" title="var">b1</span>))). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe1</span> <span class="id" title="var">IHe2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>, <span class="id" title="var">b1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>]. <span class="id" title="tactic">unfold</span> <span class="id" title="var">option_map</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">modeTransRelOpt</span> <span class="id" title="var">m</span> <span class="id" title="var">m0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
</div>

<div class="doc">
period case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">ev</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe</span> <span class="id" title="var">b0</span> (<span class="id" title="var">eq_refl</span> (<span class="id" title="var">Some</span> <span class="id" title="var">b0</span>))). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
</div>

<div class="doc">
distance case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ev1</span>, <span class="id" title="var">ev2</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe1</span> <span class="id" title="var">b0</span> (<span class="id" title="var">eq_refl</span> (<span class="id" title="var">Some</span> <span class="id" title="var">b0</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe2</span> <span class="id" title="var">b1</span> (<span class="id" title="var">eq_refl</span> (<span class="id" title="var">Some</span> <span class="id" title="var">b1</span>))). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe1</span> <span class="id" title="var">IHe2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>, <span class="id" title="var">b1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>]. <span class="id" title="tactic">unfold</span> <span class="id" title="var">option_map</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
</div>

<div class="doc">
failSafeSucc case.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">ev</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">ev</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe</span> <span class="id" title="var">b0</span> (<span class="id" title="var">eq_refl</span> (<span class="id" title="var">Some</span> <span class="id" title="var">b0</span>))). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A function that tries to evaluate the expression e into a time or fails.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">evalExpFunTime</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="var">option</span> <span class="id" title="keyword">Time</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">evalBaseNonnegFun</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">mkTime</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span> <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
List the eval relation to work between lists of expressions and lists of values.
l1 l2 is a member of this relation iff the ith element of l1 evaluates to the ith element
of l2 for all i.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">evalExpLists</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalElNil</span> : <span class="id" title="var">evalExpLists</span> [] []<br/>
&nbsp;&nbsp;| <span class="id" title="var">evalElCons</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>) (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalExpLists</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">evalExpLists</span> (<span class="id" title="var">e</span> :: <span class="id" title="var">l1</span>) (<span class="id" title="var">b</span> :: <span class="id" title="var">l2</span>).<br/>

<br/>
</div>

<div class="doc">
Convert a list of base values to a list of expressions.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">listBaselistExp</span> (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">eBase</span> <span class="id" title="var">l1</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">BoolExp</span> : <span class="id" title="keyword">Type</span> := <br/>
&nbsp;&nbsp;| <span class="id" title="var">bSufficient</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">BoolExp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bNot</span> : <span class="id" title="var">BoolExp</span> -&gt; <span class="id" title="var">BoolExp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bEqual</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">BoolExp</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bPossInc</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">BoolExp</span>.<br/>

<br/>
</div>

<div class="doc">
Equality is decidable on boolean expressions.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqDecBoolExp</span> : <span class="id" title="var">eqDec</span> <span class="id" title="var">BoolExp</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">eqDec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x1</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">x2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e1</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e0</span> <span class="id" title="var">e2</span>); <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; [<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>; [<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>, <span class="id" title="var">H1</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span> | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">reflexivity</span>] | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>]];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHx1</span> <span class="id" title="var">x2</span>); <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; [<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">f_equal</span> | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>]]. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e2</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e0</span> <span class="id" title="var">e3</span>); <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e4</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
This essentially lifts the substitution function for the expression language up
to the boolean expression language.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">subBoolExp</span> (<span class="id" title="var">s</span> : <span class="id" title="var">Subst</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BoolExp</span>) : <span class="id" title="var">BoolExp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bSufficient</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">bSufficient</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bNot</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">bNot</span> (<span class="id" title="var">subBoolExp</span> <span class="id" title="var">s</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">bEqual</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bPossInc</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span> =&gt; <span class="id" title="var">bPossInc</span> (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e3</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Evaluation relation on boolean expressions. A boolean expression may evaluate
to a boolean value.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">evalBoolExp</span> : <span class="id" title="var">BoolExp</span> -&gt; <span class="id" title="var">bool</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">bevalSufficient</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">Mode</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">Distance</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalBoolExp</span> (<span class="id" title="var">bSufficient</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">suffBool</span> <span class="id" title="var">m</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bevalNot</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalBoolExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalBoolExp</span> (<span class="id" title="var">bNot</span> <span class="id" title="var">e</span>) (<span class="id" title="var">negb</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bevalEqualTrue</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalBoolExp</span> (<span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bevalEqualFalse</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b1</span> <span class="id" title="var">b2</span> : <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">b1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">b2</span> -&gt; (<span class="id" title="var">b1</span> &lt;&gt; <span class="id" title="var">b2</span>) -&gt; <span class="id" title="var">evalBoolExp</span> (<span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bevalPossInc</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">Mode</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">Distance</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e3</span> <span class="id" title="var">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evalBoolExp</span> (<span class="id" title="var">bPossInc</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span>) (<span class="id" title="var">possIncBool</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">d</span>).<br/>

<br/>
</div>

<div class="doc">
A functional definition of the evaluation on boolean expressions.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evalBoolExpFun</span> (<span class="id" title="var">b</span> : <span class="id" title="var">BoolExp</span>) : <span class="id" title="var">option</span> <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" title="var">bSufficient</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">baseMode</span> <span class="id" title="var">m</span>), <span class="id" title="var">Some</span> (<span class="id" title="var">baseDistance</span> <span class="id" title="var">r</span>) =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">suffBool</span> <span class="id" title="var">m</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bNot</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">option_map</span> <span class="id" title="var">negb</span> (<span class="id" title="var">evalBoolExpFun</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b1</span>, <span class="id" title="var">Some</span> <span class="id" title="var">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">eqDecBase</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">left</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">right</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bPossInc</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e2</span>), (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e3</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">baseMode</span> <span class="id" title="var">m1</span>), <span class="id" title="var">Some</span> (<span class="id" title="var">baseMode</span> <span class="id" title="var">m2</span>), <span class="id" title="var">Some</span> (<span class="id" title="var">baseDistance</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">possIncBool</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
A total function for evaluating boolean expressions, which is identical to the
function evalBoolExpFun on well formed inputs, but differs in that it maps ill formed
inputs to false instead of None. This function will be used in the semantics since a
total 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">evalBoolExpFunTot</span> (<span class="id" title="var">e</span> : <span class="id" title="var">BoolExp</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">evalBoolExpFun</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Sub-Languages syntax notations
</div>
<div class="code">
<span class="id" title="keyword">Notation</span> &quot;E1 (-) E2" := (<span class="id" title="var">eSubtract</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>
<span class="id" title="keyword">Notation</span> &quot;E1 (+) E2" := (<span class="id" title="var">eAdd</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>
<span class="id" title="keyword">Notation</span> &quot;E1 (.) E2" := (<span class="id" title="var">eMult</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 29).<br/>
<span class="id" title="keyword">Notation</span> &quot;e1 =b= e2" := (<span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20).<br/>
<span class="id" title="keyword">Notation</span> &quot;| e1 , e2 |" := (<span class="id" title="var">eDist</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>
<span class="id" title="keyword">Notation</span> &quot;!~ b" := (<span class="id" title="var">bNot</span> <span class="id" title="var">b</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 25).<br/>

<br/>
</div>

<div class="doc">
The evaluation relation on expressions is a partial function i.e.
every expression evaluates to at most one value.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalExpUnique</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b1</span> <span class="id" title="var">b2</span> : <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b1</span> -&gt; <span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b2</span> -&gt; <span class="id" title="var">b1</span> = <span class="id" title="var">b2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The boolean expression relation is sound with respect to the function.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalBoolExpRelFun</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalBoolExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalBoolExpFun</span> <span class="id" title="var">e</span> = <span class="id" title="var">Some</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalBoolExp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b</span> <span class="id" title="var">b</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>, <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Bool</span>.<br/>

<br/>
</div>

<div class="doc">
The boolean expression function is sound with respect to the relation.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalBoolExpFunRel</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalBoolExpFun</span> <span class="id" title="var">e</span> = <span class="id" title="var">Some</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">evalBoolExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">intros</span>.<br/>
</div>

<div class="doc">
bSufficient case
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v1</span>, <span class="id" title="var">v2</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>, <span class="id" title="var">b1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>, <span class="id" title="var">Heqv2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
</div>

<div class="doc">
bNot case
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">negb_involutive_reverse</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHe</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalBoolExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">negb_sym</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
</div>

<div class="doc">
Equality case
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>, <span class="id" title="var">Heqv2</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">v1</span>, <span class="id" title="var">v2</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b0</span> <span class="id" title="var">b1</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b0</span> <span class="id" title="var">b1</span>); <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bevalEqualTrue</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqv1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bevalEqualFalse</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqv1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqv2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
</div>

<div class="doc">
bPossInc case
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">v3</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">v1</span>, <span class="id" title="var">v2</span>, <span class="id" title="var">v3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>, <span class="id" title="var">b1</span>, <span class="id" title="var">b2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>, <span class="id" title="var">Heqv2</span>, <span class="id" title="var">Heqv3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqv3</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>, <span class="id" title="var">b1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b0</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The evaluation relation on boolean expressions is a partial function i.e.
every expression evaluates to at most one boolean.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalBoolExpUnique</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">b1</span> <span class="id" title="var">b2</span> : <span class="id" title="var">bool</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalBoolExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b1</span> -&gt; <span class="id" title="var">evalBoolExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b2</span> -&gt; <span class="id" title="var">b1</span> = <span class="id" title="var">b2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalBoolExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalBoolExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If the evaluation of the bool exp function is true, then the total function will
evaluate to true, and vice versa.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalBoolExpTrueTot</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">BoolExp</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalBoolExp</span> <span class="id" title="var">e</span> <span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">evalBoolExpFunTot</span> <span class="id" title="var">e</span> = <span class="id" title="var">true</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalBoolExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">evalBoolExpFunTot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">evalBoolExpFunTot</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalBoolExpFun</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalBoolExpFunRel</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A discrete action is either an input of values on a channel, an output of
values on a channel or a silent (tau) action.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">DiscAct</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">inAct</span> : <span class="id" title="var">Channel</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span> -&gt; <span class="id" title="var">DiscAct</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">outAct</span> : <span class="id" title="var">Channel</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span> -&gt; <span class="id" title="var">DiscAct</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tauAct</span> : <span class="id" title="var">DiscAct</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;c *?" := (<span class="id" title="var">inAct</span> <span class="id" title="var">c</span> []) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>
<span class="id" title="keyword">Notation</span> &quot;c *!" := (<span class="id" title="var">outAct</span> <span class="id" title="var">c</span> []) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>
<span class="id" title="keyword">Notation</span> &quot;c ;? v" := (<span class="id" title="var">inAct</span> <span class="id" title="var">c</span> <span class="id" title="var">v</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>
<span class="id" title="keyword">Notation</span> &quot;c ;! v" := (<span class="id" title="var">outAct</span> <span class="id" title="var">c</span> <span class="id" title="var">v</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>

<br/>
</div>

<div class="doc">
The complement function converts inputs to outputs and vice versa.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">complement</span> (<span class="id" title="var">a</span> : <span class="id" title="var">DiscAct</span>) : <span class="id" title="var">DiscAct</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">c</span> ;? <span class="id" title="var">v</span> =&gt; <span class="id" title="var">c</span> ;! <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">c</span> ;! <span class="id" title="var">v</span> =&gt; <span class="id" title="var">c</span> ;? <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tauAct</span> =&gt; <span class="id" title="var">tauAct</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;a ^" := (<span class="id" title="var">complement</span> <span class="id" title="var">a</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 25).<br/>

<br/>
</div>

<div class="doc">
The complement function cancels itself out.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">complementInvol</span> (<span class="id" title="var">a</span> : <span class="id" title="var">DiscAct</span>) : <span class="id" title="var">a</span>^^ = <span class="id" title="var">a</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">complementNotTau</span> (<span class="id" title="var">a</span> : <span class="id" title="var">DiscAct</span>) : <span class="id" title="var">a</span> &lt;&gt; <span class="id" title="var">tauAct</span> -&gt; <span class="id" title="var">a</span>^ &lt;&gt; <span class="id" title="var">tauAct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExpRelFunEquiv</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> &lt;-&gt; <span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span> = <span class="id" title="var">Some</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span>]. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalExp_rel_fun_step</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">V</span> : <span class="id" title="var">_</span> |<span class="id" title="var">_</span>| <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">V</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalExp_rel_fun_tac</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="var">evalExp_rel_fun_step</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalExp_fun_rel_step</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">V</span> : <span class="id" title="var">Some</span> <span class="id" title="var">_</span> = <span class="id" title="var">evalExpFun</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">V</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">V</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evalExp_fun_rel_tac</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="var">evalExp_fun_rel_step</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExp_evalExpFunTime</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">t</span> : <span class="id" title="keyword">Time</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">t</span> -&gt; <span class="id" title="var">evalExpFunTime</span> <span class="id" title="var">e</span> = <span class="id" title="var">Some</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">evalExpFunTime</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp_rel_fun_tac</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">evalExpFunTime</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span>, <span class="id" title="var">H4</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">modeTransRelOpt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">H6</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExp_rel_fun_tac</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">evalExpFunTime</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
For every natural number, there is a list of base
expressions whose length is the length of that natural number. The existential witness
used here is simply <span class="inlinecode">0,</span> <span class="inlinecode">0,</span> <span class="inlinecode">0,</span> <span class="inlinecode">...</span>, the list of all zero times.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">baseListEx</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="tactic">exists</span> <span class="id" title="var">v</span>, @<span class="id" title="var">length</span> <span class="id" title="var">BaseType</span> <span class="id" title="var">v</span> = <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">exists</span> (@<span class="id" title="var">nil</span> <span class="id" title="var">BaseType</span>). <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">baseTime</span> <span class="id" title="var">zeroTime</span> :: <span class="id" title="var">x</span>). <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If one list evaluated to another, then the lengths
match.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExpListsLength</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="keyword">forall</span> (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExpLists</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">length</span> <span class="id" title="var">l</span> = <span class="id" title="var">length</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Evaluation on expressions is decidable.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExpDec</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>) : <span class="id" title="var">decidable</span> (<span class="id" title="var">evalExp</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b</span> <span class="id" title="var">b0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqo</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Evaluation on lists of expressions is decidable.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExpListsDec</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="var">evalExpLists</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>). <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">l'</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">evalExpDec</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHl</span> <span class="id" title="var">l'</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A functional version of eval exp for lists.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evalExpListsFun</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id" title="var">Some</span> []<br/>
&nbsp;&nbsp;| <span class="id" title="var">e</span> :: <span class="id" title="var">l</span> =&gt; <span class="id" title="var">optionMap2</span> (<span class="id" title="var">cons</span> (<span class="id" title="var">A</span> := <span class="id" title="var">BaseType</span>)) (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">e</span>) (<span class="id" title="var">evalExpListsFun</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The evaluation function on lists implies the relation.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalExpListsFunRel</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="keyword">forall</span> (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExpListsFun</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span> <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">evalExpLists</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpListsFun</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">optionMap2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpFunRel</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">optionMap2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">optionMap2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The evaluation relation on lists implies the function.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">evalExpListsRelFun</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="keyword">forall</span> (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">evalExpLists</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">evalExpListsFun</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">optionMap2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">option_map</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">evalExpFun</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">evalExpUnique</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">evalExpFunRel</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqo</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
l either evaluates to something or not.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExpListsExDec</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;{<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">BaseType</span> | (<span class="id" title="var">evalExpLists</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>)} +<br/>
&nbsp;&nbsp;{~<span class="id" title="tactic">exists</span> <span class="id" title="var">l'</span>, (<span class="id" title="var">evalExpLists</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>)}.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">evalExpListsFun</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>; [<span class="id" title="tactic">left</span> | <span class="id" title="tactic">right</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpListsFunRel</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">evalExpListsRelFun</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqo</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqo</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If f updated by x onto y is applied to x, then the result is y.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">updateAppEq</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">X</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">y</span> : <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> = <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">update</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If f updated by x to y is applied to z and z is not equal to x, then the
result is (f z).
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">updateAppNeq</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">X</span>) (<span class="id" title="var">x</span> <span class="id" title="var">z</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">y</span> : <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">z</span> -&gt; <span class="id" title="var">update</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> = <span class="id" title="var">f</span> <span class="id" title="var">z</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">update</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Lift a variable to a list of variables.
</div>
<div class="code">
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">liftVarList</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Var</span> := [<span class="id" title="var">v</span>].<br/>

<br/>
</div>

<div class="doc">
Lift an expression to a list of expressions.
</div>
<div class="code">
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">liftExpList</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> := [<span class="id" title="var">e</span>].<br/>

<br/>
</div>

<div class="doc">
Lift a time to an exp.
</div>
<div class="code">
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">liftTimeExp</span> (<span class="id" title="var">t</span> : <span class="id" title="keyword">Time</span>) : <span class="id" title="var">Exp</span> := <span class="id" title="var">eBase</span> (<span class="id" title="var">baseTime</span> <span class="id" title="var">t</span>).<br/>

<br/>
</div>

<div class="doc">
Lift a list of variables to a list of expressions.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">liftListVarExp</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">eVar</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FunctionalExtensionality</span>.<br/>

<br/>
</div>

<div class="doc">
The substitution of l -&gt; liftListVarExp l is equal to the identity substitution.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">listSubRefl</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">listsToSub</span> <span class="id" title="var">l</span> (<span class="id" title="var">liftListVarExp</span> <span class="id" title="var">l</span>) = <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Every list substitution has a "normal" form. That is, if we have a substitution
x -&gt; l, then there is some l' which is the same length as x such that the substitution
x -&gt; l' is equal to x -&gt; l (according to functional extensionality).
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">listSubNormal</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>),<br/>
&nbsp;&nbsp;{<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> | <span class="id" title="var">length</span> <span class="id" title="var">l'</span> = <span class="id" title="var">length</span> <span class="id" title="var">x</span> /\<br/>
&nbsp;&nbsp;<span class="id" title="var">listsToSub</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> = <span class="id" title="var">listsToSub</span> <span class="id" title="var">x</span> <span class="id" title="var">l'</span>}. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (@<span class="id" title="var">nil</span> <span class="id" title="var">Exp</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
</div>

<div class="doc">
In the case where target list is empty, the equivalent substitution is just
   the source list.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">liftListVarExp</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">x</span>)). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">map_length</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">listSubRefl</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
</div>

<div class="doc">
In the case where the target list is not empty, we can proceed by induction.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHx</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHx</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">X</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">x0</span> <span class="id" title="var">into</span> <span class="id" title="var">l'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">e</span> :: <span class="id" title="var">l'</span>). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">idSubExp</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">subExp</span> <span class="id" title="var">idSubst</span> <span class="id" title="var">e</span> = <span class="id" title="var">e</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The identity substitution leaves lists unchanged.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">idSubList</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">listSub</span> <span class="id" title="var">idSubst</span> <span class="id" title="var">l</span> = <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">idSubBoolExp</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">b</span> : <span class="id" title="var">BoolExp</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">subBoolExp</span> <span class="id" title="var">idSubst</span> <span class="id" title="var">b</span> = <span class="id" title="var">b</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e0</span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHb</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e0</span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e1</span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">idSubExp</span> <span class="id" title="var">e</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">resetPreservesId</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">resetSub</span> <span class="id" title="var">idSubst</span> <span class="id" title="var">l</span> = <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">extensionality</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;( a , b )" := (<span class="id" title="var">pair</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>).<br/>

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">splitSrc</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">fst</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">splitTgt</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">snd</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="var">Subst</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">listsToSub</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>) (<span class="id" title="var">splitTgt</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
A characterisation of the application of a substitution based on
a bindings list to a variable, which bypasses the conversion to a substitution.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">bindApp</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) : <span class="id" title="var">Exp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">y</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l'</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">e</span> <span class="id" title="keyword">else</span> <span class="id" title="var">bindApp</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">eVar</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bindListToSubCons</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>) = <span class="id" title="var">update</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bindListToSub</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">splitSrc</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">splitTgt</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Proof that the bindApp function is correct w.r.t. the substitution conversion.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">bindApp_subst</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindApp</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> = (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">bindListToSub</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
(x, e) is the first occurrence of a map of x in l if there is no
(x, e') preceding it in the list.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">firstOcc</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">fstocHd</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">fstocTl</span> (<span class="id" title="var">y</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> ((<span class="id" title="var">y</span>, <span class="id" title="var">e'</span>) :: <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_unique</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> <span class="id" title="var">e'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">e</span> = <span class="id" title="var">e'</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHfirstOcc</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">splitSrcCons</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span>*<span class="id" title="var">Exp</span>)) (<span class="id" title="var">a</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>):<br/>
&nbsp;&nbsp;<span class="id" title="var">splitSrc</span> ((<span class="id" title="var">a</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">x</span>) = <span class="id" title="var">a</span> :: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">splitSrc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_splitSrc</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">splitSrc_firstOcc_ex</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>, <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">elim</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">IHl</span> <span class="id" title="var">H0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x0</span>. <span class="id" title="tactic">constructor</span>;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A preorder on binding lists that puts one list before the other if the latter
agrees with the former on all variables in the source of the former.
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">preordBindList</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>), <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l2</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;l1 &lt;[] l2" := (<span class="id" title="var">preordBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70).<br/>

<br/>
</div>

<div class="doc">
The empty list is the bottom element of the lattice.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_emp</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;[] &lt;[] <span class="id" title="var">l</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The preorder that has been defined is reflexive.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preordBindList_refl</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="var">l</span> &lt;[] <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">incl_hd_eq</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">incl</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">incl</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">l1</span>) (<span class="id" title="var">x</span> :: <span class="id" title="var">l2</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If one binding list is less than another according to the preorder,
then the source of the former is contained in the source of the latter
according to incl.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pre_incl_splitSrc</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">incl</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>) (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">splitSrc_firstOcc_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_splitSrc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The preorder that has been defined is transitive.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preordBindList_trans</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span>: <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l2</span> &lt;[] <span class="id" title="var">l3</span> -&gt; <span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Gives back a list whose elements are those of l minus the ones containing a
variable from l'.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">excludeSrc</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| (<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">ls</span> =&gt; <span class="id" title="keyword">if</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">l'</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">excludeSrc</span> <span class="id" title="var">ls</span> <span class="id" title="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> (<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">excludeSrc</span> <span class="id" title="var">ls</span> <span class="id" title="var">l'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The source of l with l' excluded is included within the source of l.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">excludeSrc_incl</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">incl</span> (<span class="id" title="var">splitSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>)) (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">incl_refl</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">incl_tl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">incl_cons</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">incl_tl</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_inter_nil</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">A</span>), {<span class="id" title="var">x</span> = <span class="id" title="var">y</span>} + {<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span>}) : <span class="id" title="var">set_inter</span> <span class="id" title="var">p</span> <span class="id" title="var">l</span> [] = [].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If we exclude l' from l, then the source of the resultant list has no elements in
common with l'.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">excludeSrc_inter_emp</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">set_inter</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">splitSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>)) <span class="id" title="var">l'</span> = []. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">excludeSrc</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_inter</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">set_mem_complete2</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l'</span> <span class="id" title="var">n</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exclude_nil</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> [] = <span class="id" title="var">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exclude_in_splitSrc</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; ~<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v0</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pre_notIn_cons</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">l</span> &lt;[] <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">l</span> &lt;[] ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l'</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">H2</span> <span class="id" title="var">into</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H2</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exclude_preord</span> (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;(<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>) &lt;[] <span class="id" title="var">l</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">v</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">exclude_in_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">i</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>;[|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_exclude</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">preordBindList</span> <span class="id" title="var">l1</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l2</span> <span class="id" title="var">x</span>) -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">exclude_preord</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exclude_firstOcc</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>) -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">assert</span> (~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">exclude_in_splitSrc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H6</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">constructor</span>;[|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_notIn_exclude</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span> -&gt; ~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_cons_excl</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] ((<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l2</span>) -&gt; (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> [<span class="id" title="var">v</span>]) &lt;[] <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">assert</span> (~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: [<span class="id" title="var">v</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">exclude_in_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">exclude_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If (v, e) is the first occurrence of v in l1, then the question of whether l1
is less than l2 by the preorder is the same as the question as to whether l1 with
v excluded is less than l2.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fst_pre_cons_excl</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span> -&gt; (<span class="id" title="var">l1</span> &lt;[] ((<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l2</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">v</span> &lt;[] <span class="id" title="var">l2</span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preord_cons_excl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> [<span class="id" title="var">v</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>;[|<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">e0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_unique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_notIn_exclude</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_src_ex_firstOcc</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>, <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">v0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">elim</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_src_cons_eq</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">v</span> <span class="id" title="var">_</span>: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>) -&gt; (<span class="id" title="var">l1</span>&lt;[](<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l2</span> &lt;-&gt; <span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H4</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H2</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">dec_preordBindList</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span>). <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l2</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preord_emp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> []). <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_src_ex_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">x</span> <span class="id" title="var">into</span> <span class="id" title="var">e'</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">decidable</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">fst_pre_cons_excl</span>;[|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl2</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H6</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">decidable</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">notIn_src_cons_eq</span>;[|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl2</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Builds the identity bindings list for a given source list x.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">idBindList</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| <span class="id" title="var">a</span> :: <span class="id" title="var">xs</span> =&gt; (<span class="id" title="var">a</span>, <span class="id" title="var">eVar</span> <span class="id" title="var">a</span>) :: <span class="id" title="var">idBindList</span> <span class="id" title="var">xs</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The identity bind list as created by the said function gives
rise to the identity substitution.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">idBindList_idSub</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">idBindList</span> <span class="id" title="var">x</span>) = <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">idBindList</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">bindListToSub</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heql</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heql</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heql</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">IHx</span> <span class="id" title="var">l</span> <span class="id" title="var">H1</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">x0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">idSubst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The source of the identity bindings list built from x is itself x.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">srcIdBindList</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <span class="id" title="var">splitSrc</span> (<span class="id" title="var">idBindList</span> <span class="id" title="var">x</span>) = <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_emp_eq</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span>&lt;[][] -&gt; <span class="id" title="var">l</span> = []. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">cut</span> (<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> []). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bindApp_cons_eq</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindApp</span> ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>) <span class="id" title="var">x</span> = <span class="id" title="var">e</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">bindApp</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bindApp_cons_neq</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span> -&gt; <span class="id" title="var">bindApp</span> ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>) <span class="id" title="var">y</span> = <span class="id" title="var">bindApp</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bindApp</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_bindApp</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bindApp</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> = <span class="id" title="var">e</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">bindApp_cons_eq</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHfirstOcc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">bindApp_cons_neq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_cons_eq</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> <span class="id" title="var">e'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">e</span> = <span class="id" title="var">e'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">excl_cons</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">excludeSrc</span> ((<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l1</span>) <span class="id" title="var">l2</span> = (<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_bindApp_excl</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">bindApp</span> <span class="id" title="var">l1</span> <span class="id" title="var">x</span> = <span class="id" title="var">bindApp</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>) <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">excl_cons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_cons_eq</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_cons_neq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_splitSrc_excl</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If l1 &lt;<font size=-2>&#9744;</font> l2 then the substitutions generated by l1 and l2 are equivalent
for all variables in the source of l1.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">preord_subst</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span> -&gt; (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span>) <span class="id" title="var">x</span> = (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l2</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preord_emp_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_cons_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_bindApp</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_src_ex_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_cons_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_cons_neq</span>;[|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">preord_cons_excl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">notIn_bindApp_excl</span> <span class="id" title="var">x</span> <span class="id" title="var">l1</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_splitSrc_excl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Takes the binding list l and restricts its source to x, preserving any
bindings of l based in x and acting as the identity otherwise.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">restrictSrc</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| <span class="id" title="var">a</span> :: <span class="id" title="var">xs</span> =&gt; (<span class="id" title="var">a</span>, ((<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">a</span>)) :: (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The source of the restrict source function is actually correct.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrictSrc_source</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">splitSrc</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) = <span class="id" title="var">x</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">splitSrc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrictSrc_in</span> (<span class="id" title="var">y</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; (<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>)) <span class="id" title="var">y</span> = (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">y</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">listSub_notIn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span> -&gt; (<span class="id" title="var">listsToSub</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>) <span class="id" title="var">x</span> = (<span class="id" title="var">eVar</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l'</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If the source of l is included in x, then restricting l to x will yield a binding list
whose corresponding substitution is the same as that of l.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrictSrc_incl_subEq</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">incl</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> -&gt; <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) = <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_in</span>;[<span class="id" title="tactic">reflexivity</span>|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bindListToSub</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">listSub_notIn</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">listSub_notIn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_source</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inVarList_in</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">inVarList</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> = <span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_inter_exclude</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">set_inter</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> = [] -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">preordBindList</span> <span class="id" title="var">l</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_notIn_exclude</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">set_inter_nil_in1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">joinBindList</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">preordBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span> /\ <span class="id" title="var">preordBindList</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">joinBindList_symm</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l2</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">dec_joinBindList</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">dec_preordBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span>). <span class="id" title="var">addHyp</span> (<span class="id" title="var">dec_preordBindList</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Normalise the list l, by removing all redundant pairs (x, e) that are
preceded in the list, and thus overwritten, by (x, e').
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">normBindList</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| (<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l'</span> =&gt; (<span class="id" title="var">x</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">excludeSrc</span> (<span class="id" title="var">normBindList</span> <span class="id" title="var">l'</span>) [<span class="id" title="var">x</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">src_norm_in_equiv</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> (<span class="id" title="var">normBindList</span> <span class="id" title="var">l</span>) &lt;-&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">Q</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">Q</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>; (<span class="id" title="tactic">elim</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intro</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">assumption</span> |]). <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">excludeSrc_incl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_splitSrc_excl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">norm_sub_equiv</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> = <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">normBindList</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_cons_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assert</span> (~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: [<span class="id" title="var">v</span>]). <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_cons_neq</span>;[|<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">notIn_bindApp_excl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
An alternative characterisation of the preorder.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">preordBindListAlt</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">Var</span>, <span class="id" title="var">x</span> <span class="id" title="var">_</span>: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>) -&gt; <span class="id" title="var">x</span> <span class="id" title="var">_</span>: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) /\<br/>
&nbsp;&nbsp;(<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span>) <span class="id" title="var">x</span> = (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">x</span>). <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">pre_incl_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_src_ex_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">firstOcc_bindApp</span> <span class="id" title="var">x</span> <span class="id" title="var">x0</span>);[|<span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_src_ex_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">x0</span> <span class="id" title="var">into</span> <span class="id" title="var">e'</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">bindApp</span> <span class="id" title="var">l1</span> <span class="id" title="var">x</span> = <span class="id" title="var">e</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_bindApp</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">bindApp</span> <span class="id" title="var">l2</span> <span class="id" title="var">x</span> = <span class="id" title="var">e'</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_bindApp</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H4</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_norm</span> (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] (<span class="id" title="var">normBindList</span> <span class="id" title="var">l1</span>) /\ (<span class="id" title="var">normBindList</span> <span class="id" title="var">l1</span>) &lt;[] <span class="id" title="var">l1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>;[<span class="id" title="tactic">rewrite</span> <span class="id" title="var">src_norm_in_equiv</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">norm_sub_equiv</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">src_norm_in_equiv</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">norm_sub_equiv</span>];(<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;[<span class="id" title="tactic">assumption</span>|<span class="id" title="tactic">reflexivity</span>]). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
lubBindList l l1 l2 roughly means that l is a least upper bound
for bind lists l1 and l2.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">lubBindList</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">lubbl</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> (<span class="id" title="var">normBindList</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)) <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> (<span class="id" title="var">normBindList</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)) <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lubPreordFst</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lubPreordSnd</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lubBindListUnique</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> = <span class="id" title="var">l'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The existence of a least upper bound for any pair of binding lists is
a decidable property.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">decLubBindList</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">dec_joinBindList</span> (<span class="id" title="var">normBindList</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)) <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> (<span class="id" title="var">normBindList</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_bindList_id</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">x</span> <span class="id" title="var">_</span>: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">eVar</span> <span class="id" title="var">x</span> = <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">excludeSrc_in_cons_eq</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">excludeSrc</span> ((<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l1</span>) <span class="id" title="var">l2</span> = <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l2</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">append_firstOcc</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>) -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span> \/ <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_append</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lubBindList_pre_join</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; (<span class="id" title="var">normBindList</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)) &lt;[] <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">preord_norm</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">append_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">exclude_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_exclude_append</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">cut</span> (<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">v</span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">constructor</span>;[|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_firstOcc_eq</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> <span class="id" title="var">e'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">e</span> = <span class="id" title="var">e'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_unique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_lubBindList_ex</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> /\ <span class="id" title="var">preordBindList</span> <span class="id" title="var">l'</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">normBindList</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">lubBindList_pre_join</span>;<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">preord_norm</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>) ++ <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>)). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">splitSrc_firstOcc_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_exclude_append</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">x0</span> <span class="id" title="var">into</span> <span class="id" title="var">e'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span> <span class="id" title="var">e'</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">join_firstOcc_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_append</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_notIn_exclude</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_exclude_append</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If a substitution based on a list l is reset on the list of variables x, and none
of these variables of x is in the source of l, then the substitution remains unchanged
after the reset operation.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">reset_id</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">set_inter</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> = [] -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">resetSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> = (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_bindList_id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">set_inter_nil_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">inVarList_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The substitution formed after excluding x from l is the same as
that formed from l with x reset.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exclude_reset</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) = <span class="id" title="var">resetSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reset_id</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">Heqs</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">inVarList_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">i</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">Heqs</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">inVarList_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A characterisation of the matching problem for expressions. This says that
the e1 is equal to the e2 with the substitution l applied.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">matchExp</span> : <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">meVar</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="var">matchExp</span> <span class="id" title="var">e</span> (<span class="id" title="var">eVar</span> <span class="id" title="var">x</span>) ([(<span class="id" title="var">x</span>, <span class="id" title="var">e</span>)])<br/>
&nbsp;&nbsp;| <span class="id" title="var">meBase</span> (<span class="id" title="var">b</span> : <span class="id" title="var">BaseType</span>) : <span class="id" title="var">matchExp</span> (<span class="id" title="var">eBase</span> <span class="id" title="var">b</span>) (<span class="id" title="var">eBase</span> <span class="id" title="var">b</span>) []<br/>
&nbsp;&nbsp;| <span class="id" title="var">meSub</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> (<span class="id" title="var">eSubtract</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">eSubtract</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">meAdd</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> (<span class="id" title="var">eAdd</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">eAdd</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">meMult</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> (<span class="id" title="var">eMult</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">eMult</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">meWaitTime</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> (<span class="id" title="var">eWaitTime</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">eWaitTime</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">mePeriod</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e</span> <span class="id" title="var">e'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">matchExp</span> (<span class="id" title="var">ePeriod</span> <span class="id" title="var">e</span>) (<span class="id" title="var">ePeriod</span> <span class="id" title="var">e'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">meDist</span> (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> (<span class="id" title="var">eDist</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">eDist</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">meFailSafeSucc</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e</span> <span class="id" title="var">e'</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">matchExp</span> (<span class="id" title="var">eFailSafeSucc</span> <span class="id" title="var">e</span>) (<span class="id" title="var">eFailSafeSucc</span> <span class="id" title="var">e'</span>) <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
There is at most one "minimal" solution to the matching problem for expressions,
as characterised by the matchExp relation.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchExpUnique</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>|];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l4</span>; [<span class="id" title="tactic">replace</span> <span class="id" title="var">l2</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l5</span>;[<span class="id" title="tactic">assumption</span>|]|];<br/>
&nbsp;&nbsp;[<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHmatchExp2</span>; <span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExp1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>]); <span class="id" title="tactic">try</span> (<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">reflexivity</span>); <span class="id" title="tactic">try</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExp</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">assumption</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">decMatchExp</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">e1</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;</div>

<div class="doc">
For the special case where e2 is a variable.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">left</span>; <span class="id" title="tactic">exists</span> ([(<span class="id" title="var">v</span>, <span class="id" title="var">e1</span>)]); <span class="id" title="tactic">constructor</span>]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e1</span>;<br/>
&nbsp;&nbsp;</div>

<div class="doc">
For all the cases where the structures of e2 and e1 differ.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>];<br/>
&nbsp;&nbsp;</div>

<div class="doc">
For the inductive case with two hypotheses
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe2_1</span> <span class="id" title="var">e1_1</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe2_1</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">Q1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe2_2</span> <span class="id" title="var">e1_2</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe2_2</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">Q2</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">Q1</span>;[<span class="id" title="var">invertClear</span> <span class="id" title="var">Q2</span>;<br/>
&nbsp;&nbsp;[<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>; <span class="id" title="var">addHyp</span> (<span class="id" title="var">decLubBindList</span> <span class="id" title="var">x</span> <span class="id" title="var">x0</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>;[<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">try</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">meSub</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">meAdd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">meMult</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">meWaitTime</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">meDist</span>);<br/>
&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> | <span class="id" title="tactic">assumption</span>] |<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>; <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l1</span>; [<span class="id" title="tactic">replace</span> <span class="id" title="var">x0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l2</span>; [<span class="id" title="tactic">assumption</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H10</span> | <span class="id" title="tactic">assumption</span>] ]<br/>
&nbsp;&nbsp;| <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H8</span> | <span class="id" title="tactic">assumption</span>]] ]<br/>
&nbsp;&nbsp;| <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>; <span class="id" title="tactic">assumption</span> ]<br/>
&nbsp;&nbsp;| <span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecBase</span> <span class="id" title="var">b</span> <span class="id" title="var">b0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> (@<span class="id" title="var">nil</span> (<span class="id" title="var">Var</span>*<span class="id" title="var">Exp</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe2</span> <span class="id" title="var">e1</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe2</span> <span class="id" title="var">e1</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchExpSubEquivPre</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">e1</span> = <span class="id" title="var">subExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l'</span>) <span class="id" title="var">e2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">f_equal</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExp1</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubPreordFst</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span> |<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExp2</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubPreordSnd</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">preord_subst</span>; [|<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExp</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExp</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The free variables of an expression- drill down to all the eVar constructors.
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">freeVarsExp</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) : <span class="id" title="tactic">set</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eVar</span> <span class="id" title="var">v</span> =&gt; [<span class="id" title="var">v</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">eBase</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">empty_set</span> <span class="id" title="var">Var</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eSubtract</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eMult</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eAdd</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">eWaitTime</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ePeriod</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eFailSafeSucc</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">eDist</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">freeVarsListExp</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="tactic">set</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_right</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span>) [] (<span class="id" title="var">map</span> <span class="id" title="var">freeVarsExp</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">freeVarsListExpAlt</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) : <span class="id" title="tactic">set</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| <span class="id" title="var">e</span> :: <span class="id" title="var">l'</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsListExpAlt</span> <span class="id" title="var">l'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">freeVarsListAlt_correct</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">freeVarsListExp</span> <span class="id" title="var">l</span> = <span class="id" title="var">freeVarsListExpAlt</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">freeVarsListExp</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">freeVarsListExp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">freeVarsBoolExp</span> (<span class="id" title="var">b</span> : <span class="id" title="var">BoolExp</span>) : <span class="id" title="tactic">set</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bSufficient</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bNot</span> <span class="id" title="var">b'</span> =&gt; <span class="id" title="var">freeVarsBoolExp</span> <span class="id" title="var">b'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">bPossInc</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span> =&gt; <span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>)) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e3</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
TO GO: COMH BASICS.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_cons_not</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">X</span>), {<span class="id" title="var">a</span> = <span class="id" title="var">b</span>} + {<span class="id" title="var">a</span> &lt;&gt; <span class="id" title="var">b</span>})<br/>
&nbsp;&nbsp;(<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">_</span>: (<span class="id" title="var">y</span> :: <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span> \/ <span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span> /\ <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">p</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_cons_not_var</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">_</span>: (<span class="id" title="var">y</span> :: <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span> \/ <span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span> /\ <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eqDecVar</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_res_exp_sub</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) -&gt; <span class="id" title="var">e</span> = (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">v</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_firstOcc_res</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> ((<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">v</span>) (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not_var</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; [|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_restrict_incl</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) -&gt; <span class="id" title="var">incl</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_res_exp_sub</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_firstOcc_res</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_source</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_res_splitSrc</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l1</span> &lt;[] (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l2</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_source</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_incl_subEq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">incl_refl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_restrict_union1</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">l</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l'</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_restrict_incl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_restrict_union2</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l'</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">l</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l'</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_restrict_incl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lub_join_preordBindList</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">joinBindList</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l</span> &lt;[] <span class="id" title="var">l'</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_lubBindList_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Any Exp e with substitution from bindList x applied can be matched by some 
bindList z to e, where z is less than x in the preorder.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">sub_matchExp_ex</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">z</span>, <span class="id" title="var">matchExp</span> (<span class="id" title="var">subExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">e</span>) <span class="id" title="var">e</span> <span class="id" title="var">z</span><br/>
&nbsp;&nbsp;/\ <span class="id" title="var">z</span> &lt;[] (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">invertClear</span> <span class="id" title="var">IHe1</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">IHe2</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">x</span> <span class="id" title="var">into</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">x0</span> <span class="id" title="var">into</span> <span class="id" title="var">l2</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">x</span>; <span class="id" title="var">remember</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">y</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">joinBindList</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)) <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Q</span>;[<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">preord_restrict_union1</span>;<span class="id" title="tactic">assumption</span>|<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">preord_restrict_union2</span>;<span class="id" title="tactic">assumption</span>]|];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_lubBindList_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Q</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">Q</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x0</span>; <span class="id" title="tactic">split</span>; [|<span class="id" title="tactic">assumption</span>];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> | <span class="id" title="tactic">assumption</span>]);<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">invertClear</span> <span class="id" title="var">IHe</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">x</span> <span class="id" title="var">into</span> <span class="id" title="var">l'</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l'</span>; <span class="id" title="tactic">split</span>;[|<span class="id" title="tactic">assumption</span>]; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">exists</span> [(<span class="id" title="var">v</span>, (<span class="id" title="var">bindApp</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span>))]; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preordBindList_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (@<span class="id" title="var">nil</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preordBindList_refl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A characterisation of the matching problem for a list of expressions. This says that
the list l1 is equal to the list l2 with the substitution l applied.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">matchExpLists</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">Exp</span> -&gt; <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">melNil</span> : <span class="id" title="var">matchExpLists</span> [] [] []<br/>
&nbsp;&nbsp;| <span class="id" title="var">melCons</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="var">x3</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">x1</span> -&gt; <span class="id" title="var">matchExpLists</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">x2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">x3</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExpLists</span> (<span class="id" title="var">e1</span> :: <span class="id" title="var">l1</span>) (<span class="id" title="var">e2</span> :: <span class="id" title="var">l2</span>) <span class="id" title="var">x3</span>.<br/>

<br/>
</div>

<div class="doc">
A characterisation of the matching problem for a boolean expressions. This says that
the b1 equals b2 with the substitution l applied.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">matchBoolExp</span> : <span class="id" title="var">BoolExp</span> -&gt; <span class="id" title="var">BoolExp</span> -&gt; <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">mbeSuff</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchBoolExp</span> (<span class="id" title="var">bSufficient</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">bSufficient</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">mbeNot</span> (<span class="id" title="var">b</span> <span class="id" title="var">b'</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchBoolExp</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">matchBoolExp</span> (<span class="id" title="var">bNot</span> <span class="id" title="var">b</span>) (<span class="id" title="var">bNot</span> <span class="id" title="var">b'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">mbeEqual</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchBoolExp</span> (<span class="id" title="var">bEqual</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">bEqual</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">mbePossInc</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">e3</span> <span class="id" title="var">e3'</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e1'</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e2</span> <span class="id" title="var">e2'</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">matchExp</span> <span class="id" title="var">e3</span> <span class="id" title="var">e3'</span> <span class="id" title="var">l3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lubBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">lubBindList</span> <span class="id" title="var">l'</span> <span class="id" title="var">l</span> <span class="id" title="var">l3</span> -&gt;     <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">matchBoolExp</span> (<span class="id" title="var">bPossInc</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span>) (<span class="id" title="var">bPossInc</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> <span class="id" title="var">e3'</span>) <span class="id" title="var">l'</span>.<br/>

<br/>
</div>

<div class="doc">
There is at most one "minimal" solution to the matching problem for
lists of expressions as characterised by the matchExpLists relation.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchExpListsUnique</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchExpLists</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchExpLists</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l2</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExpLists</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H9</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H9</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H10</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H10</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
There is at most one "minimal" solution to the matching problem for
boolean expressions, as characterised by the matchExp relation.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchBoolExpUnique</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchBoolExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l1</span> -&gt; <span class="id" title="var">matchBoolExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>|]; <span class="id" title="tactic">replace</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l4</span>; [<span class="id" title="tactic">replace</span> <span class="id" title="var">l0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l5</span>;<br/>
&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">H10</span>|<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H9</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>]]|<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>]]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchBoolExp</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l4</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">l3</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l7</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H14</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l5</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">l0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l6</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H13</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H11</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">decMatchBoolExp</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">BoolExp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">matchBoolExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">e1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e1</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e0</span> <span class="id" title="var">e2</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decLubBindList</span> <span class="id" title="var">x</span> <span class="id" title="var">x0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H9</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe1</span> <span class="id" title="var">e2</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e1</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e0</span> <span class="id" title="var">e2</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decLubBindList</span> <span class="id" title="var">x</span> <span class="id" title="var">x0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H9</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e2</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e0</span> <span class="id" title="var">e3</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e4</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decLubBindList</span> <span class="id" title="var">x</span> <span class="id" title="var">x0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decLubBindList</span> <span class="id" title="var">x2</span> <span class="id" title="var">x1</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x3</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x3</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x2</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H14</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">lubBindListUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H15</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">l2</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H13</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H11</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">decMatchExpLists</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">matchExpLists</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">e2</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">e1</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e2</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">right</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> (@<span class="id" title="var">nil</span> (<span class="id" title="var">Var</span>*<span class="id" title="var">Exp</span>)). <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">IHe1</span> <span class="id" title="var">e2</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">e</span> <span class="id" title="var">into</span> <span class="id" title="var">e'</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">a</span> <span class="id" title="var">into</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decMatchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">decLubBindList</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x2</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpListsUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H9</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
TO GO: COMH BASICS
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_append_fst</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">fst</span> (<span class="id" title="tactic">split</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>)) = <span class="id" title="var">fst</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l1</span>) ++ <span class="id" title="var">fst</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="tactic">split</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>)). <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l1</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
TO GO: COMH BASICS
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_append_snd</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">snd</span> (<span class="id" title="tactic">split</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>)) = <span class="id" title="var">snd</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l1</span>) ++ <span class="id" title="var">snd</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="tactic">split</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>)). <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">l1</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bindSub_app_id</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span> = <span class="id" title="var">idSubst</span> -&gt; <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span> = <span class="id" title="var">idSubst</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>) = <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span> <span class="id" title="var">x</span> = <span class="id" title="var">idSubst</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_src_bindApp_id</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bindApp</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> = <span class="id" title="var">idSubst</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
TO GO: Comh Basics
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_sing</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">X</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">_</span>: [<span class="id" title="var">y</span>] -&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrict_nil_id</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span>&lt;[]<span class="id" title="var">restrictSrc</span> [] <span class="id" title="var">x</span> -&gt; <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> = <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">preord_emp_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">bindListToSub</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">x0</span> <span class="id" title="var">a</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>)). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_src_ex_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_bindApp</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_subst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_src_bindApp_id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preord_cons_excl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">notIn_bindApp_excl</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l2</span> := [<span class="id" title="var">a</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_sing</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchExp_refl</span> (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">z</span>, <span class="id" title="var">matchExp</span> <span class="id" title="var">e</span> <span class="id" title="var">e</span> <span class="id" title="var">z</span> /\ (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">z</span> = <span class="id" title="var">idSubst</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">e</span> []). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">idSubExp</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">restrict_nil_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">incl_restrict_refl</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">incl</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">x0</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span>). <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">restrictSrc_source</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">x0</span> <span class="id" title="var">_</span>: <span class="id" title="var">y</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">x0</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>)). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_source</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_in</span>;[|<span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Any list l with substitution from bindList x applied can be matched by some 
bindList z to l, where z is less than x in the preorder.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">sub_matchLists_ex</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">z</span>, <span class="id" title="var">matchExpLists</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">x</span>) <span class="id" title="var">l</span>) <span class="id" title="var">l</span> <span class="id" title="var">z</span> /\<br/>
&nbsp;&nbsp;<span class="id" title="var">preordBindList</span> <span class="id" title="var">z</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsListExp</span> <span class="id" title="var">l</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">exists</span> (@<span class="id" title="var">nil</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">preord_emp</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">IHl</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union1</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsListExp</span> <span class="id" title="var">l</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">a</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union2</span> <span class="id" title="var">x1</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsListExp</span> <span class="id" title="var">l</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">a</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">x</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsListExp</span> <span class="id" title="var">l</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">a</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">joinBindList</span> <span class="id" title="var">l0</span> <span class="id" title="var">x1</span> <span class="id" title="var">x0</span>). <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_lubBindList_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x2</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heql0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">incl_restrict_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">freeVarsListExp</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_elim</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">joinBinList_comm</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> -&gt; <span class="id" title="var">joinBindList</span> <span class="id" title="var">l1</span> <span class="id" title="var">l3</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Any boolexp b with substitution from bindList x applied can be matched by some 
bindList z to b, where z is less than x in the preorder.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">sub_matchBool_ex</span> (<span class="id" title="var">b</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">z</span>, <span class="id" title="var">matchBoolExp</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">subBoolExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">x</span>) <span class="id" title="var">b</span>) <span class="id" title="var">b</span> <span class="id" title="var">z</span><br/>
&nbsp;&nbsp;/\ <span class="id" title="var">preordBindList</span> <span class="id" title="var">z</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsBoolExp</span> <span class="id" title="var">b</span>)). <span class="id" title="tactic">induction</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span>(<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">e</span> <span class="id" title="var">x</span>); <span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">e0</span> <span class="id" title="var">x</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union1</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union2</span> <span class="id" title="var">x1</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">x</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">z'</span>; <span class="id" title="tactic">assert</span> (<span class="id" title="var">joinBindList</span> <span class="id" title="var">z'</span> <span class="id" title="var">x0</span> <span class="id" title="var">x1</span>); [<span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span> |<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_lubBindList_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H4</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x2</span>; <span class="id" title="tactic">split</span>;[<span class="id" title="tactic">econstructor</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span> | <span class="id" title="tactic">assumption</span>] |<span class="id" title="tactic">assumption</span>]]).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">IHb</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x0</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">e</span> <span class="id" title="var">x</span>); <span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">e0</span> <span class="id" title="var">x</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">sub_matchExp_ex</span> <span class="id" title="var">e1</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union1</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union2</span> <span class="id" title="var">x1</span> <span class="id" title="var">x</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">x</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">z'</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">joinBindList</span> <span class="id" title="var">z'</span> <span class="id" title="var">x0</span> <span class="id" title="var">x1</span>). <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_lubBindList_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqz'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H7</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union1</span> <span class="id" title="var">x3</span> <span class="id" title="var">x</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H7</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union2</span> <span class="id" title="var">x2</span> <span class="id" title="var">x</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">x</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">set_union</span> <span class="id" title="var">eqDecVar</span> (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e0</span>)) (<span class="id" title="var">freeVarsExp</span> <span class="id" title="var">e1</span>))) <span class="id" title="keyword">as</span> <span class="id" title="var">z''</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">joinBindList</span> <span class="id" title="var">z''</span> <span class="id" title="var">x3</span> <span class="id" title="var">x2</span>). <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_lubBindList_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H6</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H8</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x4</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchListsSubEquivPre</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">z</span> <span class="id" title="var">z'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchExpLists</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">z</span> -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">z</span> <span class="id" title="var">z'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> = <span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">z'</span>) <span class="id" title="var">l2</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">x2</span> &lt;[] <span class="id" title="var">z'</span> /\ <span class="id" title="var">x1</span> &lt;[] <span class="id" title="var">z'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H5</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H6</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H5</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H6</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpSubEquivPre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchExpLists</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchListsSubEquiv</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchExpLists</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">e1</span> = <span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">e2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">matchListsSubEquivPre</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">preordBindList_refl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">matchBoolExpSubEquivPre</span> (<span class="id" title="var">e1</span> <span class="id" title="var">e2</span> : <span class="id" title="var">BoolExp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">matchBoolExp</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">preordBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">e1</span> = <span class="id" title="var">subBoolExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l'</span>) <span class="id" title="var">e2</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H5</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H6</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H4</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H4</span> <span class="id" title="var">H5</span> <span class="id" title="var">H6</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>; <span class="id" title="var">addHyp</span> (<span class="id" title="var">preordBindList_trans</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">H2</span> <span class="id" title="var">H0</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">preordBindList_trans</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">H4</span> <span class="id" title="var">H0</span>); <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpSubEquivPre</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> | <span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span> | <span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHmatchBoolExp</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H7</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H8</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H6</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H5</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H6</span> <span class="id" title="var">H7</span> <span class="id" title="var">H8</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H5</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H8</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H7</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H9</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H7</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H7</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H7</span> <span class="id" title="var">H8</span> <span class="id" title="var">H9</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">preordBindList_trans</span> <span class="id" title="var">l</span> <span class="id" title="var">l'0</span> <span class="id" title="var">l'</span> <span class="id" title="var">H4</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">preordBindList_trans</span> <span class="id" title="var">l3</span> <span class="id" title="var">l'0</span> <span class="id" title="var">l'</span> <span class="id" title="var">H7</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">preordBindList_trans</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">H6</span> <span class="id" title="var">H5</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">preordBindList_trans</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">H3</span> <span class="id" title="var">H5</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">matchExpSubEquivPre</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">subExp_restrict_eq</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">subExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">e</span> = <span class="id" title="var">subExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span>) <span class="id" title="var">e</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" title="var">subExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">e</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">subExp</span> (<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>))) <span class="id" title="var">e</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; (<span class="id" title="tactic">f_equal</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">IHe1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">IHe2</span>]);<span class="id" title="tactic">assumption</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_in</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">restrictSrc_source</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">notIn_bindList_id</span>;[|<span class="id" title="tactic">assumption</span>]). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHe</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHe</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">subBoolExp_restrict_eq</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">b</span> : <span class="id" title="var">BoolExp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">subBoolExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">b</span> = <span class="id" title="var">subBoolExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span>) <span class="id" title="var">b</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">subBoolExp</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">b</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">subBoolExp</span> (<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>))) <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">f_equal</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <span class="id" title="var">subExp_restrict_eq</span>; <span class="id" title="tactic">assumption</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHb</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">listSub_restrict_eq</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Exp</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">l</span> = <span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span>) <span class="id" title="var">l</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l2</span>) <span class="id" title="var">l</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">listSub</span> (<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>))) <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">subExp_restrict_eq</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Exclude distributes over restrict
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">res_excl_distr</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">restrictSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span>) (<span class="id" title="var">splitSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span>)) =<br/>
&nbsp;&nbsp;<span class="id" title="var">excludeSrc</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l1</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l2</span>)) <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_bindApp_excl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_exclude_sub_eq</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">v</span> = <span class="id" title="var">v</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">cut</span> (<span class="id" title="var">bindApp</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">v</span> = <span class="id" title="var">idSubst</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">idSubst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_src_bindApp_id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">exclude_in_splitSrc</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
passiveSrc x l, read x is passive in the source of l, or just x is passive in l,
means that all variables in x are only mapped to themselves by l.
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">passiveSrc</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">psrcEmp</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="var">passiveSrc</span> [] <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">psrcConsFstOcc</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> (<span class="id" title="var">eVar</span> <span class="id" title="var">v</span>) <span class="id" title="var">l</span> -&gt; <span class="id" title="var">passiveSrc</span> (<span class="id" title="var">v</span> :: <span class="id" title="var">x</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">psrcConsNotIn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; ~<span class="id" title="var">v</span> <span class="id" title="var">_</span>: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">passiveSrc</span> (<span class="id" title="var">v</span> :: <span class="id" title="var">x</span>) <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">passive_nil</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> []. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">psrcConsNotIn</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">passive_tl</span> (<span class="id" title="var">a</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">x</span>) <span class="id" title="var">l</span> -&gt; <span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">passive_cons_eq</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> ((<span class="id" title="var">v</span>, <span class="id" title="var">eVar</span> <span class="id" title="var">v</span>) :: <span class="id" title="var">l</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">psrcConsFstOcc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">passive_tl</span>;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">psrcConsNotIn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
To Go: COMH BASICS
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_cons</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) : <br/>
&nbsp;&nbsp;~ <span class="id" title="var">x</span> <span class="id" title="var">_</span>: (<span class="id" title="var">y</span> :: <span class="id" title="var">l</span>) -&gt; ~ <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">passive_cons_notIn</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; ~<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> ((<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">notIn_cons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">psrcConsNotIn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">notIn_cons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H6</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H7</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_src_excl</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">v</span> :: <span class="id" title="var">x</span>)) = <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">v</span> :: <span class="id" title="var">x</span>)) = <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">v0</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v0</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v0</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If all members of x are mapped to themselves by l, then x is passive in l.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">idSrc_passive</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">v</span> : <span class="id" title="var">Var</span>, <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>) <span class="id" title="var">v</span> = <span class="id" title="var">eVar</span> <span class="id" title="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> ((<span class="id" title="keyword">forall</span> <span class="id" title="var">v</span> : <span class="id" title="var">Var</span>, <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> = <span class="id" title="var">v</span>)). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>)). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">splitSrc_firstOcc_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_bindApp</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_subst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> = <span class="id" title="var">a</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">psrcConsNotIn</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If x is passive in l, then excluding it from l yields the same substitution
function, and vice versa.
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">passiveSrc_exclude_equiv</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> &lt;-&gt; <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) = <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">exclude_nil</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHx</span>; [|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x0</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">x</span>)). <span class="id" title="var">invertClear</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">in_exclude_sub_eq</span>; [|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_bindApp</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">in_exclude_sub_eq</span>; [|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (~ <span class="id" title="var">x0</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H6</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">notIn_bindApp_excl</span>; [|<span class="id" title="tactic">assumption</span>]). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">notIn_src_excl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">idSrc_passive</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_exclude_sub_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">dec_passiveSrc</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">decidable</span> (<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>). <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">IHx</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">splitSrc_firstOcc_ex</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecExp</span> <span class="id" title="var">a</span> <span class="id" title="var">x0</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_unique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H8</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H8</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">psrcConsNotIn</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">passive_tl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">passive_in_firstOcc_eq</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">e</span> = <span class="id" title="var">eVar</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not_var</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_unique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHpassiveSrc</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not_var</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHpassiveSrc</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_firstOcc_id</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">v</span> (<span class="id" title="var">idBindList</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not_var</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_notIn_append</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> <span class="id" title="var">l2</span> -&gt; ~<span class="id" title="var">v</span> <span class="id" title="var">_</span>: (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>) -&gt; <span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">assert</span> (~ <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>). <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">splitSrcCons</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">passive_excl_id</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) &lt;[] <span class="id" title="var">l'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> &lt;[] (<span class="id" title="var">idBindList</span> <span class="id" title="var">x</span>) ++ <span class="id" title="var">l'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x0</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">e</span> = <span class="id" title="var">eVar</span> <span class="id" title="var">x0</span>). <span class="id" title="tactic">eapply</span> <span class="id" title="var">passive_in_firstOcc_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_append</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_firstOcc_id</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_notIn_append</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_notIn_exclude</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">srcIdBindList</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notEq_sub_excl_eq</span> (<span class="id" title="var">v</span> <span class="id" title="var">v'</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> &lt;&gt; <span class="id" title="var">v'</span> -&gt; <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">v'</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">v</span> :: <span class="id" title="var">x</span>)) <span class="id" title="var">v'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v0</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">v0</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">v0</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">e0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v0</span> <span class="id" title="var">v'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[|<span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">id_app_excl_sub_eq</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bindListToSub</span> (<span class="id" title="var">idBindList</span> <span class="id" title="var">x</span> ++ <span class="id" title="var">l</span>) = <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">exclude_nil</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">x0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">in_exclude_sub_eq</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">notEq_sub_excl_eq</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">excludeSrc_idem</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;(<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) = (<span class="id" title="var">excludeSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">x</span>). <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_restrict</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">v</span> = <span class="id" title="var">v</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindApp_subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pre_excl_res_id</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> <span class="id" title="var">w</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] (<span class="id" title="var">restrictSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l2</span> <span class="id" title="var">x</span>) <span class="id" title="var">w</span>) -&gt; <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l1</span>) <span class="id" title="var">v</span> = <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">H0</span> <span class="id" title="var">into</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l1</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">w</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_in</span>;[|<span class="id" title="tactic">assumption</span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_exclude_sub_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_restrict</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_bindList_id</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pre_excl_res_passive</span> (<span class="id" title="var">x</span> <span class="id" title="var">w</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] (<span class="id" title="var">restrictSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l2</span> <span class="id" title="var">x</span>) <span class="id" title="var">w</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">passiveSrc</span> <span class="id" title="var">x</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">idSrc_passive</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pre_excl_res_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preordBindList_cons</span> (<span class="id" title="var">a</span> : <span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)):<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> &lt;[] <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">a</span> :: <span class="id" title="var">l</span> &lt;[] <span class="id" title="var">a</span> :: <span class="id" title="var">l'</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exclude_restrict_cons</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">x</span> <span class="id" title="var">w</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">excludeSrc</span> (<span class="id" title="var">restrictSrc</span> ((<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>) <span class="id" title="var">w</span>) <span class="id" title="var">x</span> = <span class="id" title="var">excludeSrc</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">w</span>) <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHw</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">bindListToSub</span> ((<span class="id" title="var">v</span>, <span class="id" title="var">e</span>) :: <span class="id" title="var">l</span>) <span class="id" title="var">a</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bindListToSubCons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">notIn_sub_excl</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;~<span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span> -&gt; <span class="id" title="var">bindListToSub</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">v</span> = <span class="id" title="var">bindListToSub</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">bindApp_subst</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">notIn_bindApp_excl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">excl_res_distr</span> (<span class="id" title="var">x</span> <span class="id" title="var">w</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">excludeSrc</span> (<span class="id" title="var">restrictSrc</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">w</span>) <span class="id" title="var">x</span> = <span class="id" title="var">excludeSrc</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">w</span>) <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_sub_excl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_equal</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">A</span>, <span class="id" title="var">a</span> <span class="id" title="var">_</span>: <span class="id" title="var">l1</span> &lt;-&gt; <span class="id" title="var">a</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;a ={}= b" := (<span class="id" title="var">set_equal</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_not</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> ={}= <span class="id" title="var">l2</span>  -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">A</span>, ~<span class="id" title="var">a</span> <span class="id" title="var">_</span>: <span class="id" title="var">l1</span> &lt;-&gt; ~<span class="id" title="var">a</span> <span class="id" title="var">_</span>: <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_refl</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> ={}= <span class="id" title="var">l</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_trans</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> ={}= <span class="id" title="var">l2</span>  -&gt; <span class="id" title="var">l2</span> ={}= <span class="id" title="var">l3</span>  -&gt; <span class="id" title="var">l1</span> ={}= <span class="id" title="var">l3</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span>). <span class="id" title="var">addHyp</span> (<span class="id" title="var">H0</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_symm</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> ={}= <span class="id" title="var">l2</span>  -&gt; <span class="id" title="var">l2</span> ={}= <span class="id" title="var">l1</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_nil_l</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l2</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;[] ={}= <span class="id" title="var">l2</span>  -&gt; <span class="id" title="var">l2</span> = []. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">cut</span> (<span class="id" title="var">a</span> <span class="id" title="var">_</span>: []). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_nil_r</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> ={}= []  -&gt; <span class="id" title="var">l1</span> = []. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_equal_symm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_equal_nil_l</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_equal_union_app</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">A</span>, {<span class="id" title="var">a</span> = <span class="id" title="var">b</span>} + {<span class="id" title="var">a</span> &lt;&gt; <span class="id" title="var">b</span>})<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="tactic">set</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">set_union</span> <span class="id" title="var">p</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> ={}= <span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_elim</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_app_or</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equivBindList</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> /\ <span class="id" title="var">l2</span> &lt;[] <span class="id" title="var">l1</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;a =[]= b" := (<span class="id" title="var">equivBindList</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equiv_preordBindList_l</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l1'</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l1</span> =[]= <span class="id" title="var">l1'</span> -&gt; <span class="id" title="var">l1'</span> &lt;[] <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equiv_preordBindList_r</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l2'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l2</span> =[]= <span class="id" title="var">l2'</span> -&gt; <span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">l2'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">preordBindList_trans</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_symm</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> =[]= <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l2</span> =[]= <span class="id" title="var">l1</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_trans</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> =[]= <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">l2</span> =[]= <span class="id" title="var">l3</span> -&gt; <span class="id" title="var">l1</span> =[]= <span class="id" title="var">l3</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equivBindList_symm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">equiv_preordBindList_l</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>]. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">equiv_preordBindList_r</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_refl</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> =[]= <span class="id" title="var">l</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">preordBindList_refl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_exclude_notIn</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> (<span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) -&gt; ~ <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>). <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">exclude_in_splitSrc</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span> := <span class="id" title="var">l</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">firstOcc_splitSrc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_exclude_pres</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> &lt;[] <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> &lt;[] <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">preordBindList</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">exclude_firstOcc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_exclude_notIn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstOcc_notIn_exclude</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_cons</span> (<span class="id" title="var">a</span> : <span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)):<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> =[]= <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">a</span> :: <span class="id" title="var">l</span> =[]= <span class="id" title="var">a</span> :: <span class="id" title="var">l'</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">preordBindList_cons</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_exclude</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> =[]= <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> =[]= <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">preord_exclude_pres</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_splitSrc</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> =[]= <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span> ={}= <span class="id" title="var">splitSrc</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>, <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">H0</span> <span class="id" title="var">a</span>). <span class="id" title="var">addHyp</span> (<span class="id" title="var">H1</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_join</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> =[]= <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">joinBindList</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">joinBindList</span> <span class="id" title="var">l'</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <span class="id" title="var">equiv_preordBindList_r</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>]). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equivBindList_restrict</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> =[]= <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> = <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">H0</span> <span class="id" title="var">into</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">equivBindList_splitSrc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>, <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>; [| <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="var">addHyp</span> (<span class="id" title="var">H0</span> <span class="id" title="var">a</span>). <span class="id" title="var">addHyp</span> (<span class="id" title="var">H1</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> (<span class="id" title="var">splitSrc</span> <span class="id" title="var">l</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="var">addHyp</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">set_equal_not</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>;[|<span class="id" title="tactic">apply</span> <span class="id" title="var">Q</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">notIn_bindList_id</span>;[|<span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_eq_excl</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ={}= <span class="id" title="var">y</span> -&gt; <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> = <span class="id" title="var">excludeSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Heqs</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <span class="id" title="var">v</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">i</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Heqs0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">i</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_eq_res_preord</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ={}= <span class="id" title="var">y</span> -&gt; <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">preordBindListAlt</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_source</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">addHyp</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_source</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">restrictSrc_in</span>;[|<span class="id" title="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_eq_res_equiv</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ={}= <span class="id" title="var">y</span> -&gt; <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> =[]= <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">set_eq_res_preord</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_equal_symm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_eq_freeVars_map</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;(<span class="id" title="var">freeVarsListExp</span> (<span class="id" title="var">map</span> <span class="id" title="var">eVar</span> <span class="id" title="var">x</span>)) ={}= <span class="id" title="var">x</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">freeVarsListExp</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_equal_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">freeVarsListExp</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_elim</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_sing</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not_var</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro1</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_union_intro2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">firstOcc_in_src</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">Exp</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) : <br/>
&nbsp;&nbsp;<span class="id" title="var">firstOcc</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) -&gt; <span class="id" title="var">v</span> <span class="id" title="var">_</span>: <span class="id" title="var">x</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrict_add_cons_equiv</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :   <br/>
&nbsp;&nbsp;<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">set_add</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">v</span> <span class="id" title="var">x</span>) =[]= <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">v</span> :: <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_eq_res_equiv</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_equal</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_add_elim</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons_not_var</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">invertClear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_add_intro</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_add_intro</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">diff_restrict_exclude</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">set_diff</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) =[]= (<span class="id" title="var">excludeSrc</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>) <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">equivBindList_refl</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">set_mem</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">set_mem_correct1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqb</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">in_dec</span> <span class="id" title="var">eqDecVar</span> <span class="id" title="var">a</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_mem_complete1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">equivBindList_trans</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">restrict_add_cons_equiv</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">equivBindList_cons</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preord_restrict_app_join</span> (<span class="id" title="var">x</span> <span class="id" title="var">w</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> (<span class="id" title="var">Var</span> * <span class="id" title="var">Exp</span>)) :<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">l2</span> &lt;[] <span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> <span class="id" title="var">w</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">joinBindList</span> (<span class="id" title="var">restrictSrc</span> <span class="id" title="var">l</span> (<span class="id" title="var">x</span> ++ <span class="id" title="var">w</span>)) <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union1</span> <span class="id" title="var">l1</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">w</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">preord_restrict_union2</span> <span class="id" title="var">l2</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">w</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">equivBindList_join</span>;[|<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">set_eq_res_equiv</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">set_equal_union_app</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">listSub_emp_id</span> <span class="id" title="var">l</span> : <span class="id" title="var">listsToSub</span> <span class="id" title="var">l</span> [] = <span class="id" title="var">idSubst</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">resetSub_neq</span> <span class="id" title="var">s</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">v1</span> &lt;&gt; <span class="id" title="var">v2</span> -&gt; (<span class="id" title="var">resetSub</span> <span class="id" title="var">s</span> [<span class="id" title="var">v1</span>]) <span class="id" title="var">v2</span> = <span class="id" title="var">s</span> <span class="id" title="var">v2</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">v2</span> [<span class="id" title="var">v1</span>]). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">inVarList_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_sing</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">varEq_eq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> : <span class="id" title="var">true</span> = <span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> &lt;-&gt; <span class="id" title="var">x</span> = <span class="id" title="var">a</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">varEq_neq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> : <span class="id" title="var">false</span> = <span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> &lt;-&gt; <span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">varEq_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inVarList_out</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Var</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">inVarList</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> = <span class="id" title="var">false</span> &lt;-&gt; ~ <span class="id" title="var">x</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_nil</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">varEq_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">lets</span> <span class="id" title="var">NI</span> : <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">notIn_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">NI</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">NI</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">varEq</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">varEq_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqb</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_eq</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">resetSub_eq</span> <span class="id" title="var">s</span> <span class="id" title="var">v</span> : (<span class="id" title="var">resetSub</span> <span class="id" title="var">s</span> [<span class="id" title="var">v</span>]) <span class="id" title="var">v</span> = <span class="id" title="var">v</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">inVarList</span> <span class="id" title="var">v</span> [<span class="id" title="var">v</span>]). <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">inVarList_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqb</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">False_ind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_eq</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Replace a single true varEqDec
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">varEqDec_true</span> := <span class="id" title="keyword">let</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- <span class="id" title="keyword">context</span>[<span class="id" title="var">varEqDec</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">x</span>]] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">U</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">U1</span> : <span class="id" title="var">U</span> = <span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">U1</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">U</span>;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">U2</span> : <span class="id" title="var">x</span> = <span class="id" title="var">x</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">U2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">U2</span> : <span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">x</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span> <span class="id" title="var">U2</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Replace a single false varEqDec. The tactic will fail if it matches an x and a y
that aren't obviously false by inversion.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">varEqDec_false</span> := <span class="id" title="keyword">let</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- <span class="id" title="keyword">context</span>[<span class="id" title="var">varEqDec</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">y</span>]] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">U</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">U1</span> : <span class="id" title="var">U</span> = <span class="id" title="var">varEqDec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">U1</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">U</span>;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">U2</span> : <span class="id" title="var">x</span> = <span class="id" title="var">y</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">U2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">U2</span> : <span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">U2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Gets rid of lingering occurrences of resetSub in the goal.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_resets</span> := <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">resetPreservesId</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">idSubst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">liftVarList</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">resetSub</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">varEq</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">varEqDec_true</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">varEqDec_false</span>.<br/>

<br/>
</div>

<div class="doc">
Gets rid of lingering occurrences of update in the goal.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_updates</span> := <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppEq</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateAppNeq</span>;[ | <span class="id" title="tactic">solve</span> [<span class="id" title="var">neq_inversion</span>]]));<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">idSubst</span>.<br/>

<br/>
</div>

<div class="doc">
Gets rid of lingering occurrences of resetSub in the hypothesis. Tactic will
halt as soon as it encounters a resetSub that can't be eliminated, so doesn't
necessarily remove ALL possible resets from all hypotheses.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_resets_hyp</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">U</span>; <span class="id" title="var">remove_resets</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">U</span>.<br/>

<br/>
</div>

<div class="doc">
Gets rid of lingering occurrences of resetSub in the hypothesis.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_updates_hyp</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">U</span>; <span class="id" title="var">remove_updates</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">U</span>.<br/>

<br/>
</div>

<div class="doc">
Performs some simplifications to goal like removing updates and resets.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">clean_proc</span> := <span class="id" title="tactic">simpl</span>; <span class="id" title="var">remove_resets</span>; <span class="id" title="var">remove_updates</span>.<br/>

<br/>
</div>

<div class="doc">
If there's one hypothesis U (usually without any dependencies), this tactic
generalises it, applys some tactic t, and then re-assumed the hypothesis into the
hypotheses.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">gen_app_intro</span> <span class="id" title="var">t</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">U</span>; <span class="id" title="var">t</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">U</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">clean_proc_hyp</span> <span class="id" title="var">U</span> := <span class="id" title="var">gen_app_intro</span> <span class="id" title="var">clean_proc</span> <span class="id" title="var">U</span>.<br/>

<br/>
</div>

<div class="doc">
If an expression evaluates to some b, then applying a substitution to this expression
leaves it unchanged. The intuition is that evaluation entails no free variables.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eval_pres_sub</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> <span class="id" title="var">s</span> : <span class="id" title="var">e</span> |<span class="id" title="var">_</span>| <span class="id" title="var">b</span> -&gt; <span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e</span> = <span class="id" title="var">e</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalExp1</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalExp2</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHevalExp</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A stronger version of the uniqueness property of the evalution relation over
expressions. In this version, any substitution is allowed to be applied to the
expression in one of the evaluations and the equality still holds.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evalExp_sub_unique_strong</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">s</span> : <span class="id" title="var">e</span> |<span class="id" title="var">_</span>| <span class="id" title="var">b</span> -&gt; <span class="id" title="var">subExp</span> <span class="id" title="var">s</span> <span class="id" title="var">e</span> |<span class="id" title="var">_</span>| <span class="id" title="var">b'</span> -&gt; <span class="id" title="var">b</span> = <span class="id" title="var">b'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">evalExpUnique</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="var">erewrite</span> <span class="id" title="var">eval_pres_sub</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Repeatedly matches the goal to matching evaluations, creates the equality that the
corresponding base type are equal, inverts this to unpackage the contents of the base
types, and clear the original evaluations.
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">unique_exps</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="keyword">let</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">U1</span> : ?<span class="id" title="var">e1</span> |<span class="id" title="var">_</span>| ?<span class="id" title="var">b1</span>, <span class="id" title="var">U2</span> : ?<span class="id" title="var">e1</span> |<span class="id" title="var">_</span>| ?<span class="id" title="var">b2</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">b1</span> = <span class="id" title="var">b2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">U</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eapply</span> <span class="id" title="var">evalExpUnique</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">U1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">U2</span>] | ]; <span class="id" title="tactic">clear</span> <span class="id" title="var">U1</span> <span class="id" title="var">U2</span>; <span class="id" title="var">invertClear</span> <span class="id" title="var">U</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">U1</span> : ?<span class="id" title="var">e1</span> |<span class="id" title="var">_</span>| ?<span class="id" title="var">b1</span>, <span class="id" title="var">U2</span> : <span class="id" title="var">subExp</span> <span class="id" title="var">_</span> ?<span class="id" title="var">e1</span> |<span class="id" title="var">_</span>| ?<span class="id" title="var">b2</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">b1</span> = <span class="id" title="var">b2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">U</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eapply</span> <span class="id" title="var">evalExp_sub_unique_strong</span>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">U1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">U2</span>] | ]; <span class="id" title="tactic">clear</span> <span class="id" title="var">U1</span> <span class="id" title="var">U2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invertClear</span> <span class="id" title="var">U</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Given a goal of type a _: l, this tactic repeatedly checks if a is the head of l,
drilling into l until either the empty list is reached, in which case the tactic fails,
or the value a is found, in which case it proceeds with the constructor
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inList_in_tac</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- ?<span class="id" title="var">a</span> <span class="id" title="var">_</span>: (?<span class="id" title="var">a</span> :: <span class="id" title="var">_</span>)] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">in_eq</span><br/>
&nbsp;&nbsp;| [ |- <span class="id" title="var">_</span> <span class="id" title="var">_</span>: (<span class="id" title="var">_</span> :: <span class="id" title="var">_</span>)] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">in_cons</span>; <span class="id" title="var">inList_in_tac</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_notIn</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">T</span>) <span class="id" title="var">l</span> : <span class="id" title="var">b</span> &lt;&gt; <span class="id" title="var">a</span> -&gt; ~<span class="id" title="var">b</span> <span class="id" title="var">_</span>: <span class="id" title="var">l</span> -&gt; ~<span class="id" title="var">b</span> <span class="id" title="var">_</span>: (<span class="id" title="var">a</span> :: <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Given a goal of type ~a _: l, this tactic repeatedly checks if a is the head of l,
drilling into l until either the empty list is reached, in which case the tactic fails,
or the value a is found, in which case it proceeds with the constructor
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inList_out_tac</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- ~<span class="id" title="var">_</span> <span class="id" title="var">_</span>: []] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">in_nil</span><br/>
&nbsp;&nbsp;| [ |- ~<span class="id" title="var">_</span> <span class="id" title="var">_</span>: (<span class="id" title="var">_</span> :: <span class="id" title="var">_</span>)] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">cons_notIn</span>; [<span class="id" title="var">neq_inversion</span> | <span class="id" title="var">inList_out_tac</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">intro</span> <span class="id" title="var">U</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">U</span>; <span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">baseEq</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [|- ?<span class="id" title="var">x</span> = ?<span class="id" title="var">y</span>] =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">U</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Mode</span> =&gt; <span class="id" title="tactic">cut</span> (<span class="id" title="var">baseMode</span> <span class="id" title="var">x</span> = <span class="id" title="var">baseMode</span> <span class="id" title="var">y</span>);[<span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span> | ]<br/>
&nbsp;&nbsp;| <span class="id" title="keyword">Time</span> =&gt; <span class="id" title="tactic">cut</span> (<span class="id" title="var">baseTime</span> <span class="id" title="var">x</span> = <span class="id" title="var">baseTime</span> <span class="id" title="var">y</span>);[<span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span> | ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">Position</span> =&gt; <span class="id" title="tactic">cut</span> (<span class="id" title="var">basePosition</span> <span class="id" title="var">x</span> = <span class="id" title="var">basePosition</span> <span class="id" title="var">y</span>);[<span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span> | ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">Distance</span> =&gt; <span class="id" title="tactic">cut</span> (<span class="id" title="var">baseDistance</span> <span class="id" title="var">x</span> = <span class="id" title="var">baseDistance</span> <span class="id" title="var">y</span>);[<span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span> | ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">Delay</span> =&gt; <span class="id" title="tactic">cut</span> (<span class="id" title="var">baseDelay</span> <span class="id" title="var">x</span> = <span class="id" title="var">baseDelay</span> <span class="id" title="var">y</span>);[<span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span> | ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">nonnegreal</span> =&gt; <span class="id" title="tactic">cut</span> (<span class="id" title="var">baseNonneg</span> <span class="id" title="var">x</span> = <span class="id" title="var">baseNonneg</span> <span class="id" title="var">y</span>);[<span class="id" title="var">baseEq_aux</span> <span class="id" title="var">U</span>| ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; (<span class="id" title="tactic">progress</span> <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>); <span class="id" title="var">baseEq</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>
<hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>